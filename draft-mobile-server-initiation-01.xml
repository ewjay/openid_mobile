<?xml version="1.0" encoding="US-ASCII"?>
<?xml-stylesheet type='text/xsl' href='http://xml.resource.org/authoring/rfc2629.xslt' ?>
<!DOCTYPE rfc PUBLIC "-//IETF//DTD RFC 2629//EN"
"http://xml2rfc.ietf.org/authoring/rfc2629.dtd">
<!--
  NOTE:  This XML file is input used to produce the authoritative copy of an
  OpenID Foundation specification.  The authoritative copy is the HTML output.
  This XML source file is not authoritative.  The statement ipr="none" is
  present only to satisfy the document compilation tool and is not indicative
  of the IPR status of this specification.  The IPR for this specification is
  described in the "Notices" section.  This is a public OpenID Foundation
  document and not a private document, as the private="..." declaration could
  be taken to indicate.
-->
<rfc category="std" docName="draft-mobile-server-initiation-01" ipr="none">

  <?rfc toc="yes" ?>
  <?rfc tocdepth="5" ?>
  <?rfc symrefs="yes" ?>
  <?rfc sortrefs="yes"?>
  <?rfc strict="yes" ?>
  <?rfc iprnotified="no" ?>
  <?rfc private="Draft" ?>
  
  <front>
    <title abbrev="OIDC MODRNA Server Initiation Flow 1.0">
            OpenID Connect MODRNA Server Initiation Flow 1.0</title>


    <author fullname="Gonzalo Fernandez Rodriguez" initials="G." surname="Fernandez">
      <organization abbrev="Telefonica">Telefonica I+D</organization>
      <address>
        <email>gonzalo.fernandezrodriguez@telefonica.com</email>
      </address>
    </author>


    <author fullname="Florian Walter" initials="F." surname="Walter">
      <organization abbrev="">Deutsche Telekom AG</organization>
      <address>
        <email>F.Walter@telekom.de</email>
      </address>
    </author>


    <date day="8" month="Aug" year="2016"/>
    
    <workgroup>OpenID Mobile Profile Working Group</workgroup>

    <abstract>    
      <t>
        OpenID Connect allows RP's authenticate their users for clients of all types, including 
        browser-based JavaScript and native mobile apps, to launch sign-in flows and receive verifiable 
        assertions about the identity of signed-in users.
      </t>
      <t>
        All of these flows require the user to initiate the authentication flow, however, some use cases 
        not covered for these flows, where the RP needs to be the initiator the user authentication flow, 
        have been raised.
      </t>
      <t>
        The MODRNA Server Initiation Flow will specify a new authentication flow by means of which the RP's will 
        be able to initiate an interaction flow to authenticate their users.
      </t>
    </abstract>
  </front>

  <middle>
    <section anchor="Introduction" title="Introduction">
      <t>
        OpenID Connect MODRNA Server Initiation Flow 1.0 is an authentication flow of the 
        <xref target="OpenID.Core">OpenID Connect Core 1.0</xref> specification
        intended to allow RP's who already know the MSISDN of an end-user to initiate an
        authentication flow to request user authentication from MNO's. Moreover it defines 
        Mandatory to Implement features for MNOs to assure interoperability of clients across MNO's.
      </t>
      <section anchor="rnc" title="Requirements Notation and Conventions">
        <t>
          The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
          "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
          document are to be interpreted as described in <xref target="RFC2119"/>.
        </t>

        <t>
          Throughout this document, values are quoted to indicate that they are
          to be taken literally. When using these values in protocol messages, the
          quotes MUST NOT be used as part of the value.
        </t>
      </section>
    </section>
    <section anchor="terminology" title="Terminology">
      <t>
        This specification uses the termn "OpenID Provider (OP)" and "Relying Party (RP)" as
        defined by <xref target="OpenID.Core">OpenID Connect Core</xref>.
        This specification also defines the following terms: 
      </t>
      <t>
        <list style="hanging">
         <t hangText="Mobile Network Operator (MNO)">
          A provider of wireless communication services that owns or controls the wireless 
          network elements necessary to sell and deliver services to an end user.
         </t>
         <t hangText="Mobile Station International Subscriber Directory Number (MSISDN)">
          A telephone number uniquely identifying a subscription in a mobile network.  
         </t>
         <t hangText="Consumption Device (CD)">
          A user agent, most probably a browser, on which the user consumes the actual service
          provided by the Relying Party.  
         </t>
         <t hangText="Authentication Device (AD)">
          A mobile device on which the user will authenticate the actual login.
         </t>
        </list>
      </t>
    </section>
    <section anchor="overview" title="Overview">
      <t>
        This specification defines a new authentication flow based on <xref target="OpenID.Core"/>.
        It reuses most of the request parameters in the Authentication Request, as the
        same time it specifies some new parameter.
      </t>
    </section>

    <section anchor="auth_request" title="Authentication Request">
      <t>
        An Authentication Request is an <xref target="RFC6749">OAuth 2.0</xref> Authorization 
        Request that requests that the End-User be authenticated by the Authorization Server.
      </t>
      <t>
        MODRNA defines an authentication request that is requested directly from the client to
        the MNO without going through the user's browser. The client MUST send an authentication 
        request to the OpenID provider (MNO) by building an "HTTP POST" request that will take to 
        the MNO all the information needed to authenticate the user without asking her for their MSISDN.      
      </t>
      <t>
        The client MUST authenticate to the Authorization Endpoint using the authentication method registered 
        for its client_id, as described in Section 9 on <xref target="OpenID.Core"/>.
      </t>
      <t>
        Authentication Requests are made as defined in Section 3.1.2.1 from <xref target="OpenID.Core"/>,
        using the MODRNA profile. Only the following parameters are taking in consideration in the Server Initiation flow.
        The rest of the request parameters defined in <xref target="RFC6749">OAuth 2.0</xref> MUST be ignored
        by the Authorization Servers when the scope value parameter is <spanx style="verb">openidserver</spanx>.
      </t>

      <t>
        <list style="hanging">
          <t hangText="scope">
            REQUIRED. OpenID Connect implements authentication as an extension to the OAuth 2.0 
            by including the openid scope value in the Authorization Request and the different flows
            are determined through the "response_type" parameter. However all of these flows based on
            redirections are initiated by the end-user. In order to allow the OpenId provider to know
            that the flow is initiated by the RP directly, MODRNA defines a new value for the scope
            parameter <spanx style="verb">openidserver</spanx> which MUST be used in the Server Initiation Flow.
          </t>
          <t hangText="response_type">
            REQUIRED. OAuth 2.0 Response Type value that determines the authorization 
            processing flow to be used, including what parameters are returned from the 
            endpoints used. When using the Server Initiation Flow, this value is "id_token token" or "id_token". The meanings of both of these values are defined in OAuth 2.0 Multiple 
            Response Type Encoding Practices. No Access Token is returned when the value is "id_token".
          </t>
          <t hangText="redirect_uri">            
            REQUIRED. Redirection URI to which the response will be sent. This URI MUST exactly match 
            one of the Redirection URI values for the Client pre-registered at the OpenID Provider, with 
            the matching performed as described in Section 6.2.1 of [RFC3986] (Simple String Comparison). 
            When using this flow, the Redirection URI SHOULD use the https scheme.
          </t>
          <t hangText="acr_values">
            REQUIRED. As defined in MODRNA Authentication profile. 
          </t>

          <t hangText="login_hint_token">
            REQUIRED. As defined in MODRNA Authentication profile.
          </t> 
          <t hangText="binding_message">
            OPTIONAL. As defined in MODRNA Authentication profile.
          </t>
        </list>
      </t>
    </section>

    <section anchor="auth_request_validation" title="Authentication Request Validation">
      <t>
        The Authorization Server MUST validate the request received as follows:
      </t>
      <t>
        <list style="numbers">
          <t>
            Authenticate the Client if it was issued Client Credentials or if it uses another Client Authentication method, 
            as described in Section 9 on <xref target="OpenID.Core"/>.
          </t>
          <t>
            The Authorization Server MUST validate all the OAuth 2.0 parameters according to the MODRNA specification.
          </t>
          <t>
            Verify that a <spanx style="verb">scope</spanx> parameter is present and contains the <spanx style="verb">serveropenid</spanx> 
            scope value. (If no <spanx style="verb">openid</spanx> scope value is present nor <spanx style="verb">serveropenid</spanx>, 
            the request may still be a valid OAuth 2.0 request, but is not an OpenID Connect request.)
          </t>
          <t >
            The Authorization Server MUST verify that all the REQUIRED parameters are present and their usage 
            conforms to this specification.
          </t>
          <t> 
            If the sub (subject) Claim is requested with a specific value for the ID Token, the Authorization 
            Server MUST only send a positive response if the End-User identified by that sub value has an active 
            session with the Authorization Server or has been Authenticated as a result of the request. 
            The Authorization Server MUST NOT reply with an ID Token or Access Token for a different user, even 
            if they have an active session with the Authorization Server. Such a request can be made either using 
            an id_token_hint parameter or by requesting a specific Claim Value as described in Section 5.5.1 on <xref target="OpenID.Core"/>, 
            if the claims parameter is supported by the implementation.
          </t>
        </list>
      </t>
      <t>
          As specified in OAuth 2.0 [RFC6749], Authorization Servers SHOULD ignore unrecognized request parameters.
       </t>          
      <t>
          If the Authorization Server encounters any error, it MUST return an error response, per Section 3.1.2.6 on on <xref target="OpenID.Core"/>.
       </t>          
    </section>

    <section anchor="auth_request_ack" title="Authentication Request Acknowlegdment">
      <t>
        If the Authentication Validation Request is OK, the Authorization Server will return an HTTP 200 OK response to the RP
        to indicate that the authentication request has been accepted and it is going to be processed. The body of this
        response will contain:
      </t>
      <t>
        <list style="hanging">
          <t hangText="auth_req_id">
            REQUIRED. It is a unique id to identify the authentication request (transaction) made by the RP. The <spanx style="verb">auth_req_id</spanx> will be sent too in the authentication response to allow the RP to correlate the authentication request and the received tokens
            (id_token and access_token).
           </t>
          <t hangText="expires in">
            REQUIRED. Expiration time of the Authentication in seconds since the auth_request_ack was received.
           </t>          
        </list>
      </t>
      <t>
        If the Authentication Validation Request is NOK, the Authorization Server MUST return an error response, per Section 3.1.2.6.
      </t>      
    </section>

    <section anchor="auth_request_ack_validation" title="Authentication Request Acknowlegdment Validation">

      <t>
        If the client (RP) receives an HTTP 200 OK, it MUST validate that all the required parameters are received. The RP should keep the
        authentication request identifier <spanx style="verb">auth_req_id</spanx> and the expiration time in order to match it with
        the auhentication response.
      </t>
      <t>
        The client will have to keep the expiration time as well to be able to discard the authentication response.
      </t>
    </section>

    <section anchor="auth_request_error" title="Authentication Request Error">
      <t>
        TBD
      </t>
    </section>

  </middle>

  <back>
    <references title="Normative References">
      <?rfc include="reference.RFC.2119"?>
      <?rfc include="reference.RFC.7517"?>
      <?rfc include="reference.RFC.7519"?>
      <?rfc include="reference.RFC.6711"?>

      
      <reference anchor="OpenID.Core">
        <front>
          <title>OpenID Connect Core 1.0</title>

          <author fullname="Nat Sakimura" initials="N." surname="Sakimura">
            <organization abbrev="NRI">Nomura Research Institute, Ltd.</organization>
          </author>

          <author fullname="John Bradley" initials="J." surname="Bradley">
            <organization abbrev="Ping Identity">Ping Identity</organization>
          </author>

          <author fullname="Michael B. Jones" initials="M.B." surname="Jones">
            <organization abbrev="Microsoft">Microsoft</organization>
          </author>

          <author fullname="Breno de Medeiros" initials="B." surname="de Medeiros">
            <organization abbrev="Google">Google</organization>
          </author>

          <author fullname="Chuck Mortimore" initials="C." surname="Mortimore">
            <organization abbrev="Salesforce">Salesforce</organization>
          </author>

          <author fullname="Edmund Jay" initials="E." surname="Jay">
            <organization abbrev="Illumila">Illumila</organization>
          </author>

          <date day="19" month="December" year="2013"/>
        </front>

        <format target="http://openid.net/specs/openid-connect-core-1_0.html" type="HTML" />
      </reference>

      <?rfc include="reference.I-D.draft-jones-oauth-amr-values-05.xml"?>
    

      <reference anchor="OpenID.Discovery" target="http://openid.net/specs/openid-connect-discovery-1_0.html">
        <front>
          <title>OpenID Connect Discovery 1.0</title>

          <author fullname="Nat Sakimura" initials="N." surname="Sakimura">
            <organization abbrev="NRI">Nomura Research Institute, Ltd.</organization>
          </author>

          <author fullname="John Bradley" initials="J." surname="Bradley">
            <organization abbrev="Ping Identity">Ping Identity</organization>
          </author>

          <author fullname="Michael B. Jones" initials="M.B." surname="Jones">
            <organization abbrev="Microsoft">Microsoft</organization>
          </author>

          <author fullname="Edmund Jay" initials="E." surname="Jay">
            <organization abbrev="Illumila">Illumila</organization>
          </author>

          <date day="3" month="August" year="2015"/>
        </front>
      </reference>
      
    </references>
    
    <references title="Informative References">

      <?rfc include="reference.RFC.6749"?>
      <?rfc include="reference.RFC.6750"?>
      <?rfc include="reference.RFC.5246"?>
      <?rfc include="reference.RFC.2246"?>



      <reference anchor="ISO.29115">
        <front>
          <title>ISO/IEC DIS 29115</title>

                <author fullname="Erika McCallister" initials="E." surname="McAllister">
                 <organization abbrev="ISO">ISO</organization>
                </author>

                <author fullname="Richard Brackney" initials="R." surname="Brackney">
                  <organization abbrev="ITU-T">ITU-T</organization>
                </author>

          <date day="01" month="April" year="2013"/>
        </front>

        <format target="http://www.iso.org/iso/catalogue_detail.htm?csnumber=45138" type="HTML" />
      </reference>

      <reference anchor="E.164">
        <front>
          <title>Recommendation ITU-T E.164</title>

                <author fullname="N." initials="" surname="N.">
                  <organization abbrev="ITU-T">ITU-T</organization>
                </author>

          <date day="01" month="November" year="2010"/>
        </front>

        <format target="https://www.itu.int/rec/T-REC-E.164-201011-I" type="PDF" />
      </reference>

      <reference anchor="MODRNA.Discovery"
                 target="https://bitbucket.org/openid/mobile/raw/default/draft-mobile-discovery-01.txt">
        <front>
          <title>OpenID Connect Mobile Discovery Profile 1.0</title>

          <author fullname="Torsten Lodderstedt" initials="T." surname="Lodderstedt">
            <organization abbrev="">Deutsche Telekom AG</organization>
          </author>

          <author fullname="John Bradley" initials="J." surname="Bradley">
            <organization abbrev="Ping Identity">Ping Identity</organization>
          </author>

          <date day="08" month="August" year="2015"/>
        </front>
      </reference>
      
    </references>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>The following have contributed to the development of this specification.</t>
    </section>


    <section anchor="Notices" title="Notices">
      <t>Copyright (c) 2015 The OpenID Foundation.</t>
      <t>
        The OpenID Foundation (OIDF) grants to any Contributor, developer, 
        implementer, or other interested party a non-exclusive, royalty free, 
        worldwide copyright license to reproduce, prepare derivative works from, 
        distribute, perform and display, this Implementers Draft or 
        Final Specification solely for the purposes of (i) developing 
        specifications, and (ii) implementing Implementers Drafts and 
        Final Specifications based on such documents, provided that attribution 
        be made to the OIDF as the source of the material, but that such attribution 
        does not indicate an endorsement by the OIDF.
      </t>
      <t>
        The technology described in this specification was 
        made available from contributions from various sources, 
        including members of the OpenID Foundation and others.  
        Although the OpenID Foundation has taken steps to help ensure 
        that the technology is available for distribution, it takes 
        no position regarding the validity or scope of any intellectual 
        property or other rights that might be claimed to pertain to 
        the implementation or use of the technology described in 
        this specification or the extent to which any license under 
        such rights might or might not be available; neither does it 
        represent that it has made any independent effort to identify 
        any such rights.  The OpenID Foundation and the contributors 
        to this specification make no (and hereby expressly disclaim any) 
        warranties (express, implied, or otherwise), including implied 
        warranties of merchantability, non-infringement, fitness for 
        a particular purpose, or title, related to this specification, 
        and the entire risk as to implementing this specification is 
        assumed by the implementer.  The OpenID Intellectual 
        Property Rights policy requires contributors to offer 
        a patent promise not to assert certain patent claims against 
        other contributors and against implementers.  The OpenID Foundation invites 
        any interested party to bring to its attention any copyrights, 
        patents, patent applications, or other proprietary rights 
        that may cover technology that may be required to practice 
        this specification.
      </t>
    </section>

    <section anchor="History" title="Document History">
      <t>[[ To be removed from the final specification ]]</t>

      <t>-01 <list style="symbols">
          <t>Initial draft</t>
          <t>Added OIDF Standard Notice </t>
          </list>
      </t>
        
    </section>
  </back>
</rfc>
