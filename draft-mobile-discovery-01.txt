



                                                          P. Lodderstedt
                                                                      DT
                                                              J. Bradley
                                                           Ping Identity
                                                       February 07, 2014


              OpenID Connect Mobile Discovery Profile 1.0
                       draft-mobile-discovery-01

Abstract

   OpenID Connect Discovery 1.0 [OpenID.Discovery] section 2.1 specifies
   a way to normalize a user identifier to derive a resource and
   especially a host for OpenID Provider Issuer Discovery.  While this
   works well for identifiers as email addresses and urls it does not
   work for MNO identifiers.  In a mobile environment, MSISDN's or ip-
   addresses are typical resources identifying a user.  The structure of
   those identifiers does not allow for an algorithmic normalization.
   Thus it will be necessary to have a specific service to perform the
   normalization.

   The Mobile Profile will specify the interface of this service.  Part
   of the interface specification will be the identification of possible
   user input identifier types relevant in the Mobile Connect scenario.
   Remark: Some of those user input identifier types may not identify a
   single user/device but may be sufficient to identify the right mobile
   operator.  An example for this is the MNC/MCC tuple (mobile network
   code/ mobile contry code) or the IP address range.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Requirements Notation and Conventions . . . . . . . . . .   2
     1.2.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Overview  . . . . . . . . . . . . . . . . . . . . . . . . . .   2
   3.  Account Chooser . . . . . . . . . . . . . . . . . . . . . . .   3
     3.1.  AC Client . . . . . . . . . . . . . . . . . . . . . . . .   3
     3.2.  AC Identity Provider  . . . . . . . . . . . . . . . . . .   3
   4.  User Discovery Service  . . . . . . . . . . . . . . . . . . .   4
     4.1.  Registration  . . . . . . . . . . . . . . . . . . . . . .   4
     4.2.  Request . . . . . . . . . . . . . . . . . . . . . . . . .   4
     4.3.  Response  . . . . . . . . . . . . . . . . . . . . . . . .   5
     4.4.  Error Response  . . . . . . . . . . . . . . . . . . . . .   5
     4.5.  Discovery endpoint Response . . . . . . . . . . . . . . .   5
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .   5
   6.  Privacy Considerations  . . . . . . . . . . . . . . . . . . .   5
   7.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   6



Lodderstedt & Bradley    Expires August 11, 2014                [Page 1]

                    OIDC Mobile Discoery Profile 1.0       February 2014


   8.  Normative References  . . . . . . . . . . . . . . . . . . . .   6
   Appendix A.  Acknowledgements . . . . . . . . . . . . . . . . . .   6
   Appendix B.  Notices  . . . . . . . . . . . . . . . . . . . . . .   7
   Appendix C.  Document History . . . . . . . . . . . . . . . . . .   7
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   8

1.  Introduction

   OpenID Connect Mobile Discovery Profile 1.0 is a profile of the
   OpenID Connect Discovery 1.0 [OpenID.Discovery] specification that
   stipulates how a OpenID Connect client can use MNO identifiers to
   determine the authoritative issuer for a identifier thereby enabling
   a Single SignOn experience for End-Users.

1.1.  Requirements Notation and Conventions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

   Throughout this document, values are quoted to indicate that they are
   to be taken literally.  When using these values in protocol messages,
   the quotes MUST NOT be used as part of the value.

1.2.  Terminology

   This specification uses the terms "Access Token", "Refresh Token",
   "Authorization Code", "Authorization Grant", "Authorization Server",
   "Authorization Endpoint", "Client", "Client Identifier", "Client
   Secret", "Protected Resource", "Resource Owner", "Resource Server",
   and "Token Endpoint" defined by OAuth 2.0 [RFC6749].  This
   specification also defines the following terms:

   Primary Token  An OAuth token (access, refresh, and id_token)
      obtained by the _TA_ for its own uses.

   Secondary Token  An OAuth access token obtained by the _TA_ on behalf
      of another native application.

2.  Overview

   Overview.

   OpenID Connect Clients using this specification are encouraged to use
   the OpenID Account chooser service.  This allows them to bypass
   discovery for users that already have account information cached.





Lodderstedt & Bradley    Expires August 11, 2014                [Page 2]

                    OIDC Mobile Discoery Profile 1.0       February 2014


3.  Account Chooser

3.1.  AC Client

   It is recommended that Web server clients use the Account Chooser
   Central Data Store (CDS) for discovering the users preferred account.

   Account Chooser is invoked with the following script:

   The client needs to host a account-tatus endpoint.  This endpoint
   will be passed the information from the account that the user
   selects.

   <script type="text/javascript"
        src="https://www.accountchooser.com/ac.js" />
   <script>
    accountchooser.CONFIG.uiConfig = {
       title: 'Sign in to Example.com',
       favicon: 'http://example.com/favicon.ico',
       branding: 'http://example.com/branding/ac-blurb.html'
        };
   </script>

3.2.  AC Identity Provider

   Identity providers will populate the account information in Account
   Chooser's browser local storrage as the result of a successful loggin
   before redirecting the user back to the client.

   If the user account has not been provisioned in the Browsers local
   storrage, the Identity provider MUST offer to store the account
   before redirecting the user back to the Connect client.

   The following is an example of the script elements invoking ac.js
   offering to store an account:
















Lodderstedt & Bradley    Expires August 11, 2014                [Page 3]

                    OIDC Mobile Discoery Profile 1.0       February 2014


   <script type="text/javascript"
       src="https://www.accountchooser.com/ac.js" />
   <script type="text/javascript">
       accountchooser.CONFIG = {
       // Sets the home-page URL to "/top"
       homeUrl: '/top',

       // Instructs ac.js to offer storage of an account via
       // accountchooser.com
       storeAccount: {
           email: '555-1212@babytel.com",
           displayName: "Santa Claus",
           login_hint_token:
           "eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ.
        OKOawDo13gRp2ojaHV7LFpZcgV7T6DVZKTyKOMTYUmKoTCVJRgckCL9kiMT03JGe
        ipsEdY3mx_etLbbWSrFr05kLzcSr4qKAq7YN7e9jwQRb23nfa6c9d-StnImGyFDb
        Sv04uVuxIp5Zms1gNxKKK2Da14B8S4rzVRltdYwam_lDp5XnZAYpQdb76FdIKLaV
        mqgfwX7XWRxv2322i-vDxRfqNzo_tETKzpVLzfiwQyeyPGLBIO56YJ7eObdv0je8
        1860ppamavo35UgoRdbYaBcoh9QcfylQr66oc6vFWXRcZ_ZT2LawVCWTIy3brGPi
        6UklfCpIMfIjf7iGdXKHzg.
        48V1_ALb6US04U3b.
        5eym8TW_c8SuK0ltJ3rpYIzOeDQz7TALvtu6UG9oMo4vpzs9tX_EFShS8iB7j6ji
        SdiwkIr3ajwQzaBtQD_A.
        XFBoMYUZodetZdvTiFvSkQ",
           providerId: "babytel.com"
       }
   };
   </script>

4.  User Discovery Service

4.1.  Registration

   The client must register with the discovery service and have a valid
   OAuth client_id.

4.2.  Request

   The client creates a authorization request using the OAuth scope
   "providerid"

   The following additional optional request paramaters are defined:

   MCC  The Mobile Country Code as defined by ITU-T E.212







Lodderstedt & Bradley    Expires August 11, 2014                [Page 4]

                    OIDC Mobile Discoery Profile 1.0       February 2014


4.3.  Response

   The Authorization server returns a code or token depending on the
   requested response type.

4.4.  Error Response

4.5.  Discovery endpoint Response

   The response from the Discovery endpoint is a JSON object containing
   the following top level elements:

   user_iss  The Issuer URI "iss" for the user who has authorized
      discovery.

   login_hint_token  A Encrypted JSON web token (JWE) that contains the
      user hint for the issuer.  The token MUST be encrypted with the
      public key of the issuer.  This token is passed to the issuer in
      the authentication request.  This token contains the following
      elements:

      iss  The party creating the token.

      aud  The party to receive the token, typically the users IdP.  The
         value SHOULD be the "iss" URI of the IdP.

      iat  When the token was issued.

      MCC  NUMERIC Mobile Country Code ITU-T E.212

      MNC  NUMERIC Mobile Network operator code ITU-T E.212

      MSISDN  NUMERIC The Subscriber identifier

      login_hint  STRING A account identifier for the user

      ip_address  STRING A IP address for the users device.

5.  Security Considerations

   TBD

6.  Privacy Considerations

   TBD






Lodderstedt & Bradley    Expires August 11, 2014                [Page 5]

                    OIDC Mobile Discoery Profile 1.0       February 2014


7.  IANA Considerations

   This document makes no requests of IANA.

8.  Normative References

   [AC]       "Account Chooser (AC)", May 2013.

   [JWT]      Jones, M., Bradley, J., and N. Sakimura, "JSON Web Token
              (JWT)", draft-ietf-oauth-json-web-token (work in
              progress), May 2013.

   [OpenID.Core]
              Sakimura, N., Bradley, J., Jones, M., de Medeiros, B.,
              Mortimore, C., and E. Jay, "OpenID Connect Standard 1.0",
              December 2013.

   [OpenID.Discovery]
              Sakimura, N., Bradley, J., Jones, M., and E. Jay, "OpenID
              Connect Discovery 1.0", September 2014.

   [OpenID.Registration]
              Sakimura, N., Bradley, J., and M. Jones, "OpenID Connect
              Dynamic Client Registration 1.0", December 2013.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC2246]  Dierks, T. and C. Allen, "The TLS Protocol Version 1.0",
              RFC 2246, January 1999.

   [RFC5246]  Dierks, T. and E. Rescorla, "The Transport Layer Security
              (TLS) Protocol Version 1.2", RFC 5246, August 2008.

   [RFC6749]  Hardt, D., "The OAuth 2.0 Authorization Framework", RFC
              6749, October 2012.

   [RFC6750]  Jones, M. and D. Hardt, "The OAuth 2.0 Authorization
              Framework: Bearer Token Usage", RFC 6750, October 2012.

Appendix A.  Acknowledgements

   The following have contributed to the development of this
   specification.







Lodderstedt & Bradley    Expires August 11, 2014                [Page 6]

                    OIDC Mobile Discoery Profile 1.0       February 2014


Appendix B.  Notices

   Copyright (c) 2014 The OpenID Foundation.

   The OpenID Foundation (OIDF) grants to any Contributor, developer,
   implementer, or other interested party a non-exclusive, royalty free,
   worldwide copyright license to reproduce, prepare derivative works
   from, distribute, perform and display, this Implementers Draft or
   Final Specification solely for the purposes of (i) developing
   specifications, and (ii) implementing Implementers Drafts and Final
   Specifications based on such documents, provided that attribution be
   made to the OIDF as the source of the material, but that such
   attribution does not indicate an endorsement by the OIDF.

   The technology described in this specification was made available
   from contributions from various sources, including members of the
   OpenID Foundation and others.  Although the OpenID Foundation has
   taken steps to help ensure that the technology is available for
   distribution, it takes no position regarding the validity or scope of
   any intellectual property or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this specification or the extent to which any license under such
   rights might or might not be available; neither does it represent
   that it has made any independent effort to identify any such rights.
   The OpenID Foundation and the contributors to this specification make
   no (and hereby expressly disclaim any) warranties (express, implied,
   or otherwise), including implied warranties of merchantability, non-
   infringement, fitness for a particular purpose, or title, related to
   this specification, and the entire risk as to implementing this
   specification is assumed by the implementer.  The OpenID Intellectual
   Property Rights policy requires contributors to offer a patent
   promise not to assert certain patent claims against other
   contributors and against implementers.  The OpenID Foundation invites
   any interested party to bring to its attention any copyrights,
   patents, patent applications, or other proprietary rights that may
   cover technology that may be required to practice this specification.

Appendix C.  Document History

   [[ To be removed from the final specification ]]

   -01

   o  Initial draft

   o  Added OIDF Standard Notice





Lodderstedt & Bradley    Expires August 11, 2014                [Page 7]

                    OIDC Mobile Discoery Profile 1.0       February 2014


Authors' Addresses

   Torsten Lodderstedt
   Deutsche Telekom AG

   Email: torsten@lodderstedt.net


   John Bradley
   Ping Identity

   Email: jbradley@pingidentity.com







































Lodderstedt & Bradley    Expires August 11, 2014                [Page 8]
