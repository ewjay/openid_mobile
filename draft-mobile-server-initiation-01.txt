



                                                            G. Fernandez
                                                              Telefonica
                                                               F. Walter
                                                     Deutsche Telekom AG
                                                          August 8, 2016


            OpenID Connect MODRNA Server Initiation Flow 1.0
                   draft-mobile-server-initiation-01

Abstract

   OpenID Connect allows RP's authenticate their users for clients of
   all types, including browser-based JavaScript and native mobile apps,
   to launch sign-in flows and receive verifiable assertions about the
   identity of signed-in users.

   All of these flows require the user to initiate the authentication
   flow, however, some use cases not covered for these flows, where the
   RP needs to be the initiator the user authentication flow, have been
   raised.

   The MODRNA Server Initiation Flow will specify a new authentication
   flow by means of which the RP's will be able to initiate an
   interaction flow to authenticate their users.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Requirements Notation and Conventions . . . . . . . . . .   2
   2.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   2
   3.  Overview  . . . . . . . . . . . . . . . . . . . . . . . . . .   2
   4.  Authentication Request  . . . . . . . . . . . . . . . . . . .   3
   5.  Authentication Request Validation . . . . . . . . . . . . . .   4
   6.  Authentication Request Acknowlegdment . . . . . . . . . . . .   5
   7.  Authentication Request Acknowlegdment Validation  . . . . . .   5
   8.  Authentication Request Error  . . . . . . . . . . . . . . . .   5
   9.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   5
     9.1.  Normative References  . . . . . . . . . . . . . . . . . .   5
     9.2.  Informative References  . . . . . . . . . . . . . . . . .   6
   Appendix A.  Acknowledgements . . . . . . . . . . . . . . . . . .   7
   Appendix B.  Notices  . . . . . . . . . . . . . . . . . . . . . .   7
   Appendix C.  Document History . . . . . . . . . . . . . . . . . .   8
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   8







Fernandez & Walter      Expires February 9, 2017                [Page 1]

                 OIDC MODRNA Server Initiation Flow 1.0      August 2016


1.  Introduction

   OpenID Connect MODRNA Server Initiation Flow 1.0 is an authentication
   flow of the OpenID Connect Core 1.0 [OpenID.Core] specification
   intended to allow RP's who already know the MSISDN of an end-user to
   initiate an authentication flow to request user authentication from
   MNO's.  Moreover it defines Mandatory to Implement features for MNOs
   to assure interoperability of clients across MNO's.

1.1.  Requirements Notation and Conventions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

   Throughout this document, values are quoted to indicate that they are
   to be taken literally.  When using these values in protocol messages,
   the quotes MUST NOT be used as part of the value.

2.  Terminology

   This specification uses the termn "OpenID Provider (OP)" and "Relying
   Party (RP)" as defined by OpenID Connect Core [OpenID.Core].  This
   specification also defines the following terms:

   Mobile Network Operator (MNO)  A provider of wireless communication
      services that owns or controls the wireless network elements
      necessary to sell and deliver services to an end user.

   Mobile Station International Subscriber Directory Number (MSISDN)  A
      telephone number uniquely identifying a subscription in a mobile
      network.

   Consumption Device (CD)  A user agent, most probably a browser, on
      which the user consumes the actual service provided by the Relying
      Party.

   Authentication Device (AD)  A mobile device on which the user will
      authenticate the actual login.

3.  Overview

   This specification defines a new authentication flow based on
   [OpenID.Core].  It reuses most of the request parameters in the
   Authentication Request, as the same time it specifies some new
   parameter.





Fernandez & Walter      Expires February 9, 2017                [Page 2]

                 OIDC MODRNA Server Initiation Flow 1.0      August 2016


4.  Authentication Request

   An Authentication Request is an OAuth 2.0 [RFC6749] Authorization
   Request that requests that the End-User be authenticated by the
   Authorization Server.

   MODRNA defines an authentication request that is requested directly
   from the client to the MNO without going through the user's browser.
   The client MUST send an authentication request to the OpenID provider
   (MNO) by building an "HTTP POST" request that will take to the MNO
   all the information needed to authenticate the user without asking
   her for their MSISDN.

   The client MUST authenticate to the Authorization Endpoint using the
   authentication method registered for its client_id, as described in
   Section 9 on [OpenID.Core].

   Authentication Requests are made as defined in Section 3.1.2.1 from
   [OpenID.Core], using the MODRNA profile.  Only the following
   parameters are taking in consideration in the Server Initiation flow.
   The rest of the request parameters defined in OAuth 2.0 [RFC6749]
   MUST be ignored by the Authorization Servers when the scope value
   parameter is "openidserver".

   scope  REQUIRED.  OpenID Connect implements authentication as an
      extension to the OAuth 2.0 by including the openid scope value in
      the Authorization Request and the different flows are determined
      through the "response_type" parameter.  However all of these flows
      based on redirections are initiated by the end-user.  In order to
      allow the OpenId provider to know that the flow is initiated by
      the RP directly, MODRNA defines a new value for the scope
      parameter "openidserver" which MUST be used in the Server
      Initiation Flow.

   response_type  REQUIRED.  OAuth 2.0 Response Type value that
      determines the authorization processing flow to be used, including
      what parameters are returned from the endpoints used.  When using
      the Server Initiation Flow, this value is "id_token token" or
      "id_token".  The meanings of both of these values are defined in
      OAuth 2.0 Multiple Response Type Encoding Practices.  No Access
      Token is returned when the value is "id_token".

   redirect_uri  REQUIRED.  Redirection URI to which the response will
      be sent.  This URI MUST exactly match one of the Redirection URI
      values for the Client pre-registered at the OpenID Provider, with
      the matching performed as described in Section 6.2.1 of [RFC3986]
      (Simple String Comparison).  When using this flow, the Redirection
      URI SHOULD use the https scheme.



Fernandez & Walter      Expires February 9, 2017                [Page 3]

                 OIDC MODRNA Server Initiation Flow 1.0      August 2016


   acr_values  REQUIRED.  As defined in MODRNA Authentication profile.

   login_hint_token  REQUIRED.  As defined in MODRNA Authentication
      profile.

   binding_message  OPTIONAL.  As defined in MODRNA Authentication
      profile.

5.  Authentication Request Validation

   The Authorization Server MUST validate the request received as
   follows:

   1.  Authenticate the Client if it was issued Client Credentials or if
       it uses another Client Authentication method, as described in
       Section 9 on [OpenID.Core].

   2.  The Authorization Server MUST validate all the OAuth 2.0
       parameters according to the MODRNA specification.

   3.  Verify that a "scope" parameter is present and contains the
       "serveropenid" scope value.  (If no "openid" scope value is
       present nor "serveropenid", the request may still be a valid
       OAuth 2.0 request, but is not an OpenID Connect request.)

   4.  The Authorization Server MUST verify that all the REQUIRED
       parameters are present and their usage conforms to this
       specification.

   5.  If the sub (subject) Claim is requested with a specific value for
       the ID Token, the Authorization Server MUST only send a positive
       response if the End-User identified by that sub value has an
       active session with the Authorization Server or has been
       Authenticated as a result of the request.  The Authorization
       Server MUST NOT reply with an ID Token or Access Token for a
       different user, even if they have an active session with the
       Authorization Server.  Such a request can be made either using an
       id_token_hint parameter or by requesting a specific Claim Value
       as described in Section 5.5.1 on [OpenID.Core], if the claims
       parameter is supported by the implementation.

   As specified in OAuth 2.0 [RFC6749], Authorization Servers SHOULD
   ignore unrecognized request parameters.

   If the Authorization Server encounters any error, it MUST return an
   error response, per Section 3.1.2.6 on on [OpenID.Core].





Fernandez & Walter      Expires February 9, 2017                [Page 4]

                 OIDC MODRNA Server Initiation Flow 1.0      August 2016


6.  Authentication Request Acknowlegdment

   If the Authentication Validation Request is OK, the Authorization
   Server will return an HTTP 200 OK response to the RP to indicate that
   the authentication request has been accepted and it is going to be
   processed.  The body of this response will contain:

   auth_req_id  REQUIRED.  It is a unique id to identify the
      authentication request (transaction) made by the RP.  The
      "auth_req_id" will be sent too in the authentication response to
      allow the RP to correlate the authentication request and the
      received tokens (id_token and access_token).

   expires in  REQUIRED.  Expiration time of the Authentication in
      seconds since the auth_request_ack was received.

   If the Authentication Validation Request is NOK, the Authorization
   Server MUST return an error response, per Section 3.1.2.6.

7.  Authentication Request Acknowlegdment Validation

   If the client (RP) receives an HTTP 200 OK, it MUST validate that all
   the required parameters are received.  The RP should keep the
   authentication request identifier "auth_req_id" and the expiration
   time in order to match it with the auhentication response.

   The client will have to keep the expiration time as well to be able
   to discard the authentication response.

8.  Authentication Request Error

   TBD

9.  References

9.1.  Normative References

   [I-D.jones-oauth-amr-values]
              Jones, M., Hunt, P., and A. Nadalin, "Authentication
              Method Reference Values", draft-jones-oauth-amr-values-05
              (work in progress), February 2016.

   [OpenID.Core]
              Sakimura, N., Bradley, J., Jones, M., de Medeiros, B.,
              Mortimore, C., and E. Jay, "OpenID Connect Core 1.0",
              December 2013.





Fernandez & Walter      Expires February 9, 2017                [Page 5]

                 OIDC MODRNA Server Initiation Flow 1.0      August 2016


   [OpenID.Discovery]
              Sakimura, N., Bradley, J., Jones, M., and E. Jay, "OpenID
              Connect Discovery 1.0", August 2015,
              <http://openid.net/specs/
              openid-connect-discovery-1_0.html>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

   [RFC6711]  Johansson, L., "An IANA Registry for Level of Assurance
              (LoA) Profiles", RFC 6711, DOI 10.17487/RFC6711, August
              2012, <http://www.rfc-editor.org/info/rfc6711>.

   [RFC7517]  Jones, M., "JSON Web Key (JWK)", RFC 7517,
              DOI 10.17487/RFC7517, May 2015,
              <http://www.rfc-editor.org/info/rfc7517>.

   [RFC7519]  Jones, M., Bradley, J., and N. Sakimura, "JSON Web Token
              (JWT)", RFC 7519, DOI 10.17487/RFC7519, May 2015,
              <http://www.rfc-editor.org/info/rfc7519>.

9.2.  Informative References

   [E.164]    N., , "Recommendation ITU-T E.164", November 2010.

   [ISO.29115]
              McAllister, E. and R. Brackney, "ISO/IEC DIS 29115", April
              2013.

   [MODRNA.Discovery]
              Lodderstedt, T. and J. Bradley, "OpenID Connect Mobile
              Discovery Profile 1.0", August 2015,
              <https://bitbucket.org/openid/mobile/raw/default/draft-
              mobile-discovery-01.txt>.

   [RFC2246]  Dierks, T. and C. Allen, "The TLS Protocol Version 1.0",
              RFC 2246, DOI 10.17487/RFC2246, January 1999,
              <http://www.rfc-editor.org/info/rfc2246>.

   [RFC5246]  Dierks, T. and E. Rescorla, "The Transport Layer Security
              (TLS) Protocol Version 1.2", RFC 5246,
              DOI 10.17487/RFC5246, August 2008,
              <http://www.rfc-editor.org/info/rfc5246>.






Fernandez & Walter      Expires February 9, 2017                [Page 6]

                 OIDC MODRNA Server Initiation Flow 1.0      August 2016


   [RFC6749]  Hardt, D., Ed., "The OAuth 2.0 Authorization Framework",
              RFC 6749, DOI 10.17487/RFC6749, October 2012,
              <http://www.rfc-editor.org/info/rfc6749>.

   [RFC6750]  Jones, M. and D. Hardt, "The OAuth 2.0 Authorization
              Framework: Bearer Token Usage", RFC 6750,
              DOI 10.17487/RFC6750, October 2012,
              <http://www.rfc-editor.org/info/rfc6750>.

Appendix A.  Acknowledgements

   The following have contributed to the development of this
   specification.

Appendix B.  Notices

   Copyright (c) 2015 The OpenID Foundation.

   The OpenID Foundation (OIDF) grants to any Contributor, developer,
   implementer, or other interested party a non-exclusive, royalty free,
   worldwide copyright license to reproduce, prepare derivative works
   from, distribute, perform and display, this Implementers Draft or
   Final Specification solely for the purposes of (i) developing
   specifications, and (ii) implementing Implementers Drafts and Final
   Specifications based on such documents, provided that attribution be
   made to the OIDF as the source of the material, but that such
   attribution does not indicate an endorsement by the OIDF.

   The technology described in this specification was made available
   from contributions from various sources, including members of the
   OpenID Foundation and others.  Although the OpenID Foundation has
   taken steps to help ensure that the technology is available for
   distribution, it takes no position regarding the validity or scope of
   any intellectual property or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this specification or the extent to which any license under such
   rights might or might not be available; neither does it represent
   that it has made any independent effort to identify any such rights.
   The OpenID Foundation and the contributors to this specification make
   no (and hereby expressly disclaim any) warranties (express, implied,
   or otherwise), including implied warranties of merchantability, non-
   infringement, fitness for a particular purpose, or title, related to
   this specification, and the entire risk as to implementing this
   specification is assumed by the implementer.  The OpenID Intellectual
   Property Rights policy requires contributors to offer a patent
   promise not to assert certain patent claims against other
   contributors and against implementers.  The OpenID Foundation invites
   any interested party to bring to its attention any copyrights,



Fernandez & Walter      Expires February 9, 2017                [Page 7]

                 OIDC MODRNA Server Initiation Flow 1.0      August 2016


   patents, patent applications, or other proprietary rights that may
   cover technology that may be required to practice this specification.

Appendix C.  Document History

   [[ To be removed from the final specification ]]

   -01

   o  Initial draft

   o  Added OIDF Standard Notice

Authors' Addresses

   Gonzalo Fernandez Rodriguez
   Telefonica I+D

   Email: gonzalo.fernandezrodriguez@telefonica.com


   Florian Walter
   Deutsche Telekom AG

   Email: F.Walter@telekom.de


























Fernandez & Walter      Expires February 9, 2017                [Page 8]